<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Zachaxy">





<title>计算机的启动流程 | Hexo</title>



    <link rel="icon" href="/image/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Zachaxy&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Zachaxy&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">计算机的启动流程</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Zachaxy&nbsp;&#124;&nbsp;</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">September 15, 2019&nbsp;&nbsp;16:31:41&nbsp;&#124;&nbsp;</a>
                        </span>
                    

                    
                        <span class="post-count">
                        Words: <a href="#">3.4k&nbsp;&#124;&nbsp;</a>
                        </span>
                    

                    
                        <span class="post-readtime">
                        About: <a href="#">3 mins.</a>
                        </span>
                    

                    
                </div>
            
        </header>

        <div class="post-content">
            <p>按下主机的电源键，伴随着屏幕上一闪而过的打印信息,片刻之后计算机就启动了,如果我们安装了多个系统，计算机会让我们选择一个系统来启动。。。这些过程中，计算机的内部都经历了什么？<br>接下来的内容将对计算机的启动有一个简单的介绍。</p>
<span id="more"></span>

<h1 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h1><p>市面上的个人计算机一般都搭载了各自的操作系统，eg：windows，macOS，Ubuntu等，这些操作系统的代码在计算机的硬盘或者U盘中，是不能自启动的，需要一个引导启动的程序来将它们加载到内存中，那么这个加载的过程就是计算机启动的流程。</p>
<ul>
<li>强硬件相关的：由烧写在硬件电路中的程序负责执行引导流程</li>
<li>操作系统无关的：不论安装什么类型的操作系统，都要遵守引导程序的规则，否则无法被载入到内存中。</li>
</ul>
<p>计算机的整个启动过程分成四个阶段：</p>
<ol>
<li>BIOS启动</li>
<li>主引导记录</li>
<li>硬盘启动</li>
<li>操作系统启动</li>
</ol>
<h1 id="BIOS启动"><a href="#BIOS启动" class="headerlink" title="BIOS启动"></a>BIOS启动</h1><p>上个世纪70年代初，”只读内存”（read-only memory，缩写为ROM）问世，开机引导程序被写入ROM中，在计算机通电后，第一件事就是读取并执行这段程序。该过程有硬件厂商来实现。这段程序有一个名字叫 BIOS（Basic Input&#x2F;Output System）。其主要流程如下：</p>
<h2 id="1-硬件自检"><a href="#1-硬件自检" class="headerlink" title="1. 硬件自检"></a>1. 硬件自检</h2><p>BIOS程序首先检查计算机硬件能否满足运行的基本条件，这叫做”硬件自检”（Power-On Self-Test），缩写为POST。如果硬件出现问题，主板会发出不同含义的蜂鸣，启动中止。如果没有问题，屏幕就会显示出CPU、内存、硬盘等信息。</p>
<p><img src="https://raw.githubusercontent.com/zachaxy/zachaxy.github.io/hexo/images/bg2013021503.png" alt="boot info"></p>
<h2 id="2-确定启动顺序"><a href="#2-确定启动顺序" class="headerlink" title="2. 确定启动顺序"></a>2. 确定启动顺序</h2><p>经过上一步的硬件自检完成后，BIOS把控制权转交给下一阶段的启动程序。这时，BIOS需要知道，”下一阶段的启动程序”具体存放在哪里。<br>如果你自己安装过系统，那么对这个一定不陌生。系统的启动并不一定是硬盘，也可能是U盘或者软盘，这一步的设置可以在BIOS中进行设定</p>
<p><img src="https://raw.githubusercontent.com/zachaxy/zachaxy.github.io/hexo/images/1282003915_iQipOt.jpg" alt="boot sequence"></p>
<p>BIOS会根据外部储存设备的排序，排在前面的设备就是优先转交控制权的设备。这种排序叫做”启动顺序”（Boot Sequence）。</p>
<h1 id="主引导记录"><a href="#主引导记录" class="headerlink" title="主引导记录"></a>主引导记录</h1><p>BIOS按照”启动顺序”，把控制权转交给合适的储存设备。注意，这里并不是在启动顺序中排在首位，就一定从该设备启动的，因为要想真正的启动设备，该设备必须符合规范，计算机会读取该设备最前面的512个字节。如果这512个字节的最后两个字节是0x55和0xAA，表明这个设备可以用于启动；如果不是，表明设备不能用于启动，控制权于是被转交给”启动顺序”中的下一个设备。</p>
<p>这最前面的512个字节，就叫做”主引导记录”（Master boot record，缩写为MBR）。实现一个操作系统，必须要满足最后两个字节是0x55和0xAA即可，前面的510个字节，只要能正确将操作系统引导到内存即可。但是现代操作系统如果要实现更好的系统启动管理，没有一定的规范是不可能的。下面介绍下主引导记录的结构，并了解分区表的基本概念，但是依然要提醒，这并非必须的！</p>
<h2 id="1-主引导记录的结构"><a href="#1-主引导记录的结构" class="headerlink" title="1 主引导记录的结构"></a>1 主引导记录的结构</h2><p>“主引导记录”只有512个字节，是不可能放下整个操作系统的。其主要作用是，告诉计算机到硬盘的哪一个位置去找操作系统。</p>
<p>主引导记录由三个部分组成：</p>
<ol>
<li>第1-446字节：调用操作系统的机器码。</li>
<li>第447-510字节：分区表（Partition table）。</li>
<li>第511-512字节：主引导记录签名（0x55和0xAA）。</li>
</ol>
<p>其中，第二部分”分区表”的作用，是将硬盘分成若干个区。</p>
<h2 id="2-分区表"><a href="#2-分区表" class="headerlink" title="2 分区表"></a>2 分区表</h2><p>在使用Windows时，我们的硬盘一般会划分C&#x2F;D&#x2F;E&#x2F;F盘，操作系统一般会放在C盘（当然，这个并不是必须的，而是可以设置的），针对这种情况，”主引导记录” 就必须知道将控制权转交给哪个区，也就是说要具体从哪个盘启动操作系统。</p>
<p>分区表的长度只有64个字节，里面又分成四项，每项16个字节。所以，一个硬盘最多只能分四个一级分区，又叫做”主分区”。</p>
<p>每个主分区的16个字节，由6个部分组成：</p>
<ol>
<li>第1个字节：如果为0x80，就表示该主分区是激活分区，控制权要转交给这个分区。四个主分区里面只能有一个是激活的。</li>
<li>第2-4个字节：主分区第一个扇区的物理位置（柱面、磁头、扇区号等等）。</li>
<li>第5个字节：主分区类型。</li>
<li>第6-8个字节：主分区最后一个扇区的物理位置。</li>
<li>第9-12字节：该主分区第一个扇区的逻辑地址。</li>
<li>第13-16字节：主分区的扇区总数。</li>
</ol>
<p>最后的四个字节（”主分区的扇区总数”），决定了这个主分区的长度。也就是说，一个主分区的扇区总数最多不超过2的32次方。</p>
<p>如果每个扇区为512个字节，就意味着单个分区最大不超过2TB。再考虑到扇区的逻辑地址也是32位，所以单个硬盘可利用的空间最大也不超过2TB。如果想使用更大的硬盘，只有2个方法：一是提高每个扇区的字节数，二是增加扇区总数。</p>
<h1 id="硬盘启动"><a href="#硬盘启动" class="headerlink" title="硬盘启动"></a>硬盘启动</h1><p>这里以最常见的硬盘启动为例，计算机的控制权就要转交给硬盘的某个分区了，这里又分成三种情况。</p>
<h2 id="1-卷引导记录"><a href="#1-卷引导记录" class="headerlink" title="1 卷引导记录"></a>1 卷引导记录</h2><p>这种方式也是最常见的一种方式，计算机上只安装的一个操作系统，根据前面提到，四个主分区里面，只有一个是激活的。计算机会读取激活分区的第一个扇区，叫做”卷引导记录”（Volume boot record，缩写为VBR）。<br>“卷引导记录”的主要作用是，告诉计算机，操作系统在这个分区里的位置。然后，计算机就会加载操作系统了。</p>
<h2 id="2-扩展分区和逻辑分区"><a href="#2-扩展分区和逻辑分区" class="headerlink" title="2 扩展分区和逻辑分区"></a>2 扩展分区和逻辑分区</h2><p>随着硬盘越来越大，四个主分区已经不够了，需要更多的分区。但是，分区表只有四项，因此规定有且仅有一个区可以被定义成”扩展分区”（Extended partition）。<br>所谓”扩展分区”，就是指这个区里面又分成多个区。这种分区里面的分区，就叫做”逻辑分区”（logical partition）。一般这种情况是安装了双系统的情况，eg：我们在c盘安装了windows系统，同时又分出一个单独的盘用来安装Ubuntu。</p>
<p>计算机先读取扩展分区的第一个扇区，叫做”扩展引导记录”（Extended boot record，缩写为EBR）。它里面也包含一张64字节的分区表，但是最多只有两项（也就是两个逻辑分区）。<br>计算机接着读取第二个逻辑分区的第一个扇区，再从里面的分区表中找到第三个逻辑分区的位置，以此类推，直到某个逻辑分区的分区表只包含它自身为止（即只有一个分区项）。因此，扩展分区可以包含无数个逻辑分区。</p>
<p>但是，似乎很少通过这种方式启动操作系统，因为这种方式的安装较为复杂，同时无法给用户提供选择进入哪个系统，仅仅是作为了解，因为如果操作系统确实安装在扩展分区，一般采用下面Grub的方式启动。</p>
<h2 id="3-启动管理器"><a href="#3-启动管理器" class="headerlink" title="3 启动管理器"></a>3 启动管理器</h2><p>安装双系统，这种情况最为常见的，如果你之前在window上安装过ubuntu的双系统，那么对Easybcd 这个软件应该不陌生，这个软件就是修改主引导记录的前512字节里面的代码，这时计算机读取”主引导记录”前面446字节的机器码之后，不再把控制权转交给某一个分区，而是运行事先安装的”启动管理器”（boot loader），由用户选择启动哪一个操作系统。Linux环境中，目前最流行的启动管理器是Grub。在计算机启动的时候，会出现一个菜单供你选择启动哪个系统。</p>
<p><img src="https://raw.githubusercontent.com/zachaxy/zachaxy.github.io/hexo/images/201701343941760.png" alt="boot select"></p>
<h1 id="操作系统启动"><a href="#操作系统启动" class="headerlink" title="操作系统启动"></a>操作系统启动</h1><p>控制权转交给操作系统后，操作系统的内核首先被载入内存。</p>
<p>以Linux系统为例，先载入&#x2F;boot目录下面的kernel。内核加载成功后，第一个运行的程序是&#x2F;sbin&#x2F;init。它根据配置文件 &#x2F;etc&#x2F;initab，产生init进程。这是Linux启动后的第一个进程，pid进程编号为1，其他进程都是它的后代。</p>
<p>然后，init线程加载系统的各个模块，比如窗口程序和网络程序，直至执行&#x2F;bin&#x2F;login程序，跳出登录界面，等待用户输入用户名和密码。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>计算机的启动，本质上就是要把操作系统加载到内存中，一旦操作系统加载到内存中，接下来就开始执行操作系统内部的逻辑了。<br>但是要实现这一功能，就必须引入一个引导程序，通过硬件上电后立即执行（BIOS），先检测当前硬件环境是否正常，历史原因，随着硬件的逐步发展，软盘，硬盘，U盘等存储介质的出现，BIOS也要兼容市面上的几种引导介质，接下来开始从设置好的启动顺序中逐个判断该设备是否可以引导操作系统。一旦确定了设备，接下来就要确定操作系统在目标引导设备上的具体位置，根据一层层的缩小范围，最终将操作系统加载到内存中。</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>本文作者:</span>
                        <span>Zachaxy</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>版权声明:</span>
                        <span>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E6%9D%A5%E6%98%AF%E8%BF%99%E6%A0%B7/"># 计算机原来是这样</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2019/10/01/quick-start-of-uml/">快速绘制UML图</a>
            
            
            <a class="next" rel="next" href="/2019/09/07/how-to-use-curl/">curl 使用指南</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Zachaxy | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>